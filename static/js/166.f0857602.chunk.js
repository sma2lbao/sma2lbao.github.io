"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[166],{34826:function(e,i,n){n.d(i,{Y:function(){return p},Z:function(){return _}});var t=n(4962),o=n(6914),a=n(52202),r=n(51955),l=n(2815),s=n(35890),d=n(5197),c=n(16831),u=["url"],v={player:"".concat("ShadowPlayer","-player")},h=(0,l.ZP)(d.Ue)((function(){return(0,a.Z)({},"& .".concat(v.player),{width:"100% !important",height:"100% !important",background:"#000"})})),p=function(e){var i=e.url,n=(0,o.Z)(e,u),a=null===i||void 0===i?void 0:i.toString().endsWith(".m3u8"),l=r.createRef();return(0,c.jsx)(h,{ratio:16/9,children:(0,c.jsx)(s.Z,(0,t.Z)((0,t.Z)({ref:l,className:v.player},n),{},{url:i,config:{file:{forceHLS:a,attributes:{controlsList:"nodownload noremoteplayback",disablePictureInPicture:!0}},youtube:{playerVars:{autoplay:n.playing,modestbranding:1,rel:0,showinfo:0,controls:n.controls},embedOptions:{}}}}))})};p.defaultProps={controls:!0,playing:!0};var x=n(56828),f=n(19305),m=n(91992),Z=n(14934),g=n(88404),j=["youtubeUrl"],y="withThird",b={wrap:"".concat(y,"-wrap"),tool:"".concat(y,"-tool"),grouped:"".concat(y,"-grouped")},w=(0,l.ZP)("div")((function(e){var i,n=e.theme;return i={},(0,a.Z)(i,"&.".concat(b.wrap),{position:"relative",width:"100%"}),(0,a.Z)(i,"& .".concat(b.tool),{position:"absolute",right:n.spacing(1),top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",justifyContent:"space-between",maxHeight:"50%",overflow:"auto",background:"rgba(0, 0, 0, .1)",backdropFilter:"blur(8px)",color:"#fff",padding:n.spacing(1),borderRadius:n.shape.borderRadius,visibility:"hidden","$wrap:hover &":{visibility:"initial"}}),(0,a.Z)(i,"& .".concat(b.grouped),{border:"none","&:not(:first-child)":{borderRadius:n.shape.borderRadius},"&:first-child":{borderRadius:n.shape.borderRadius}}),i}));function _(e){return function(i){var n=i.youtubeUrl,a=(0,o.Z)(i,j),l=a&&a.url?a.url:void 0,s=r.useState(l),d=(0,x.Z)(s,2),u=d[0],v=d[1],h=r.useState(),p=(0,x.Z)(h,2),y=p[0],_=p[1],k=n&&a&&a.url&&a.url!==n;return r.useEffect((function(){v("youtube"===y?n:l)}),[y,l,n]),(0,c.jsxs)(w,{className:b.wrap,children:[(0,c.jsx)(e,(0,t.Z)((0,t.Z)({},a),{},{url:u})),k&&(0,c.jsx)("div",{className:b.tool,children:(0,c.jsx)(f.Z,{theme:{palette:{type:"dark"}},children:(0,c.jsx)(m.Z,{classes:{grouped:b.grouped},orientation:"vertical",value:y,exclusive:!0,onChange:function(e,i){_(i)},children:(0,c.jsx)(Z.Z,{value:"youtube",children:(0,c.jsx)(g.Z,{})})})})})]})}}},97166:function(e,i,n){n.r(i),n.d(i,{ShadowPlayContext:function(){return $},default:function(){return K}});var t=n(56828),o=n(51955),a=n(34826),r=n(14417),l=n(55824),s=n(8884),d=n(40663),c=n(27949),u=n(4962),v=n(52202),h=n(2815),p=n(52066),x=n(93200),f=n(77969),m=n(16480),Z=n(10926),g=n.n(Z),j=n(16831),y="CommentItem",b={avatar:"".concat(y,"-avatar"),main:"".concat(y,"-main"),infoItem:"".concat(y,"-infoItem"),commentText:"".concat(y,"-commentText")},w=(0,h.ZP)(r.Z)((function(e){var i,n=e.theme;return i={},(0,v.Z)(i,"& .".concat(b.avatar),{marginRight:n.spacing(2)}),(0,v.Z)(i,"& .".concat(b.main),{flex:1}),(0,v.Z)(i,"& .".concat(b.infoItem),{"& + &":{marginLeft:n.spacing(2)}}),(0,v.Z)(i,"& .".concat(b.commentText),{marginTop:n.spacing(1)}),i}));var _=function(e){var i,n,t;return(0,j.jsxs)(w,{children:[(0,j.jsxs)(r.Z,{display:"flex",children:[(0,j.jsx)(m.Z,{className:b.avatar,src:null===(i=e.author)||void 0===i?void 0:i.avatar}),(0,j.jsxs)("div",{className:b.main,children:[(0,j.jsxs)(r.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,j.jsx)(p.Z,{children:null===(n=e.author)||void 0===n?void 0:n.nickname}),(0,j.jsx)(p.Z,{variant:"caption",color:"GrayText",children:g()(e.create_at).format("YYYY-MM-DD HH:mm")})]}),(0,j.jsx)(r.Z,{display:"flex",children:(0,j.jsx)(p.Z,{variant:"caption",color:"GrayText",children:null===(t=e.author)||void 0===t?void 0:t.description})})]})]}),(0,j.jsx)(p.Z,{variant:"body2",className:b.commentText,children:e.content})]})},k=n(60889),C=function(e){var i=o.useState(""),n=(0,t.Z)(i,2),a=n[0],l=n[1],s=function(){l("")};return(0,j.jsxs)(r.Z,{display:"flex",children:[(0,j.jsx)(k.Z,{fullWidth:!0,value:a,onChange:function(e){return l(e.target.value)},placeholder:"\u968f\u4fbf\u53d1\u70b9~"}),(0,j.jsx)(f.Z,{sx:{marginLeft:2},variant:"outlined",onClick:function(){e.onSubmit&&e.onSubmit(a,s)},disabled:!a,children:"\u63d0\u4ea4"})]})},T=n(46405),I=n(81259),S="index",N={item:"".concat(S,"-item"),commentTitle:"".concat(S,"-commentTitle")},P=(0,h.ZP)(r.Z)((function(e){var i,n=e.theme;return i={},(0,v.Z)(i,"& .".concat(N.item),{padding:n.spacing(2,0),"& + &":{borderTop:"1px solid ".concat(n.palette.divider)}}),(0,v.Z)(i,"& .".concat(N.commentTitle),{padding:n.spacing(1,0)}),i}));function D(){var e,i,n,a,l,s,d=o.useContext($),v=(0,t.Z)(d,2)[1],h=v?+(null===v||void 0===v?void 0:v.id):-1,m=(0,T.DP)({variables:{query:{last:16},type:T.OZ.Medium,type_id:h},skip:-1===h}),Z=m.data,g=m.loading,y=m.fetchMore,b=m.error;(0,T.Fj)({variables:{type:T.OZ.Medium,type_id:h},skip:-1===h,onSubscriptionData:function(e){var i,n=e.client,t=null===(i=e.subscriptionData.data)||void 0===i?void 0:i.review_created;n.writeQuery({query:T.fS,variables:{query:{last:16},type:T.OZ.Medium,type_id:h},data:Object.assign({},Z,{reviews_paginated:(0,u.Z)((0,u.Z)({},null===Z||void 0===Z?void 0:Z.reviews_paginated),{},{edges:[{cursor:Date.now(),__typename:"ReviewEdge",node:t}].concat((0,c.Z)((null===Z||void 0===Z?void 0:Z.reviews_paginated.edges)||[]))})})})}});var w=(0,T.F3)(),k=(0,t.Z)(w,1)[0];return(0,j.jsxs)(P,{children:[(0,j.jsx)(C,{onSubmit:function(e,i){k({variables:{review:{content:e,type:T.OZ.Medium,type_id:h}}}),i()}}),(0,j.jsx)(p.Z,{variant:"subtitle2",className:N.commentTitle}),(0,j.jsx)("div",{children:null!==Z&&void 0!==Z&&null!==(e=Z.reviews_paginated)&&void 0!==e&&null!==(i=e.edges)&&void 0!==i&&i.length?(0,j.jsxs)(x.Z,{spacing:2,direction:"column",children:[null===Z||void 0===Z||null===(n=Z.reviews_paginated)||void 0===n||null===(a=n.edges)||void 0===a?void 0:a.map((function(e,i){return(0,j.jsx)(r.Z,{marginY:1,children:(0,j.jsx)(_,(0,u.Z)({},e.node))},i)})),(null===Z||void 0===Z||null===(l=Z.reviews_paginated)||void 0===l||null===(s=l.pageInfo)||void 0===s?void 0:s.hasNextPage)&&(0,j.jsx)(r.Z,{textAlign:"center",children:(0,j.jsx)(f.Z,{onClick:function(){y({variables:{type:T.OZ.Medium,type_id:h,query:{last:8,before:null===Z||void 0===Z?void 0:Z.reviews_paginated.pageInfo.endCursor}},updateQuery:function(e,i){var n,t=i.fetchMoreResult;if(null!==t&&void 0!==t&&null!==(n=t.reviews_paginated)&&void 0!==n&&n.edges){var o=t.reviews_paginated,a=o.edges;return{reviews_paginated:{pageInfo:o.pageInfo,totalCount:o.totalCount,edges:[].concat((0,c.Z)(e.reviews_paginated.edges||[]),(0,c.Z)(a)),__typename:e.reviews_paginated.__typename}}}return e}})},disabled:g,children:(0,j.jsx)(p.Z,{color:"textSecondary",variant:"caption",children:g?"\u52a0\u8f7d\u4e2d...":"\u52a0\u8f7d\u66f4\u591a"})})})]}):(0,j.jsx)(I.qZ,{sx:{textAlign:"center"},error:!!b,loading:g,placeholder:!0,placeholderSubtitle:"\u6682\u65e0\u8bc4\u8bba"})})]})}var R=n(34325),Y=n(66530),M=n(23921),O=n(4555),B=n(11604);function H(){var e=(0,O.UO)().id,i=(0,O.s0)(),n=(0,T.Z8)({variables:{shadow_id:e}}),t=n.data,o=n.error;return n.loading?(0,j.jsx)("div",{children:"loading"}):o?(0,j.jsx)("div",{children:"error"}):(0,j.jsxs)(r.Z,{py:2,children:[(0,j.jsx)(p.Z,{variant:"subtitle1",gutterBottom:!0,children:"\u63a5\u4e0b\u6765\u64ad\u653e"}),null!==t&&void 0!==t&&t.shadow_next_urges_by_shadow.length?(0,j.jsx)(Y.Z,{rowHeight:"auto",cols:4,children:t.shadow_next_urges_by_shadow.map((function(e,n){return(0,j.jsx)(M.Z,{cols:1,children:(0,j.jsx)(R.h6,(0,u.Z)((0,u.Z)({},e),{},{onClickRoot:function(){return i("/shadow/".concat(e.id))},onClickAuthor:function(){return i("/profile/".concat(e.author.username))}}))},n)}))}):(0,j.jsx)("div",{children:(0,j.jsx)(B.ZP,{subtitle:"\u6682\u65e0\u53ef\u64ad\u653e\u8d44\u6e90"})})]})}var L=n(69006),q=n(28773),z=n(48547),A=n(8216),U=n(34635),F="index",E={root:"".concat(F,"-root"),header:"".concat(F,"-header"),infoItem:"".concat(F,"-infoItem"),toolBox:"".concat(F,"-toolBox"),toolText:"".concat(F,"-toolText"),description:"".concat(F,"-description")},W=(0,h.ZP)("div")((function(e){var i,n=e.theme;return i={},(0,v.Z)(i,"& .".concat(E.root),{}),(0,v.Z)(i,"& .".concat(E.header),{display:"flex",justifyContent:"space-between",marginBottom:n.spacing(1)}),(0,v.Z)(i,"& .".concat(E.infoItem),{"& + &":{marginLeft:n.spacing(1)}}),(0,v.Z)(i,"& .".concat(E.toolBox),{display:"flex",alignItems:"center",marginRight:n.spacing(2)}),(0,v.Z)(i,"& .".concat(E.toolText),{marginLeft:n.spacing(.5)}),(0,v.Z)(i,"& .".concat(E.description),{marginBottom:n.spacing(1)}),i}));function G(){var e=o.useContext($),i=(0,t.Z)(e,2),n=i[0],a=i[1],l=(0,U.F)({owner_uid:null===n||void 0===n?void 0:n.shadow.author.uid}),s=l.following,d=l.toggleFollow,c=(0,T.xW)({fetchPolicy:"network-only",variables:{medium_id:Number(null===a||void 0===a?void 0:a.id)}}),u=(0,t.Z)(c,2),v=u[0],h=u[1].data,x=(0,T.b7)({update:function(e){e.modify({fields:{vote:function(){},shadow:function(){}}})}}),Z=(0,t.Z)(x,1)[0],y=function(e){var i=e;(null===h||void 0===h?void 0:h.vote.status)===i&&e!==T.i7.Default&&(i=T.i7.Default),Z({variables:{vote:{medium_id:a?+a.id:-1,status:i}}})};return o.useEffect((function(){null!==a&&void 0!==a&&a.id&&v()}),[a,v]),(0,j.jsxs)(W,{children:[(0,j.jsxs)(r.Z,{className:E.header,children:[(0,j.jsxs)("div",{children:[(0,j.jsx)(p.Z,{variant:"subtitle1",children:(null===a||void 0===a?void 0:a.name)||(null===n||void 0===n?void 0:n.shadow.title)}),(0,j.jsx)(r.Z,{display:"flex",children:(0,j.jsxs)(p.Z,{variant:"caption",className:E.infoItem,children:["\u53d1\u5e03\u65f6\u95f4:"," ",g()(null===n||void 0===n?void 0:n.shadow.create_at).format("YYYY-MM-DD HH:mm")]})})]}),(0,j.jsxs)(r.Z,{display:"flex",alignItems:"center",children:[(0,j.jsxs)(r.Z,{className:E.toolBox,children:[(0,j.jsx)(L.Z,{color:(null===h||void 0===h?void 0:h.vote.status)===T.i7.Likd?"primary":"default",size:"small",onClick:function(){return y(T.i7.Likd)},children:(0,j.jsx)(q.Z,{fontSize:"small"})}),(0,j.jsx)(p.Z,{className:E.toolText,children:null===a||void 0===a?void 0:a.vote_like_count})]}),(0,j.jsxs)(r.Z,{className:E.toolBox,children:[(0,j.jsx)(L.Z,{color:(null===h||void 0===h?void 0:h.vote.status)===T.i7.Dislike?"primary":"default",size:"small",onClick:function(){return y(T.i7.Dislike)},children:(0,j.jsx)(z.Z,{fontSize:"small"})}),(0,j.jsx)(p.Z,{className:E.toolText,children:null===a||void 0===a?void 0:a.vote_dislike_count})]}),(0,j.jsx)(L.Z,{size:"small",children:(0,j.jsx)(A.Z,{fontSize:"small"})})]})]}),(0,j.jsx)(p.Z,{className:E.description,variant:"body2",children:(null===a||void 0===a?void 0:a.description)||(null===n||void 0===n?void 0:n.shadow.description)}),(0,j.jsxs)(r.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,j.jsxs)(r.Z,{display:"flex",alignItems:"center",children:[(0,j.jsx)(m.Z,{src:null===n||void 0===n?void 0:n.shadow.author.avatar}),(0,j.jsxs)(r.Z,{ml:1,children:[(0,j.jsx)(p.Z,{variant:"subtitle2",children:null===n||void 0===n?void 0:n.shadow.author.nickname}),(0,j.jsx)(p.Z,{variant:"caption",children:null===n||void 0===n?void 0:n.shadow.author.description})]})]}),s?(0,j.jsx)(f.Z,{onClick:d,children:"\u5df2\u5173\u6ce8"}):(0,j.jsx)(f.Z,{onClick:d,children:"\u5173\u6ce8"})]})]})}var Q=n(7607),J=n(13436),V=(0,a.Z)(a.Y),$=o.createContext([void 0,void 0]);function K(){var e=(0,O.UO)().id,i=(0,O.TH)(),n=o.useState(!0),a=(0,t.Z)(n,1)[0],c=(i.state||{medium_id:void 0}).medium_id,u=o.useState(),v=(0,t.Z)(u,2),h=v[0],p=v[1],x=(0,T.uJ)({variables:{id:e}}).data;return o.useEffect((function(){var e,i;if(null!==x&&void 0!==x&&null!==(e=x.shadow)&&void 0!==e&&null!==(i=e.sources)&&void 0!==i&&i.length){var n=x.shadow.sources.find((function(e){return+e.id===+c}));p(n||x.shadow.sources[0])}}),[x,c]),(0,j.jsxs)(r.Z,{sx:{height:"100%"},children:[(0,j.jsx)(J.q,{children:(0,j.jsx)("title",{children:null===x||void 0===x?void 0:x.shadow.title})}),(0,j.jsxs)($.Provider,{value:[x,h],children:[(0,j.jsxs)(d.IT,{children:[(0,j.jsx)(d.A1,{children:(0,j.jsx)(l.Z,{in:a,style:{width:"100%"},children:(0,j.jsx)(s.Z,{severity:"warning",children:"\u8d44\u6e90\u6765\u81ea\u5176\u4ed6\u7f51\u7ad9\uff0c\u8bf7\u52ff\u76f8\u4fe1\u5f71\u7247\u4e2d\u5e7f\u544a\u3002"})})}),(0,j.jsx)(d.A1,{children:(0,j.jsx)(V,{controls:!0,playing:!0,youtubeUrl:null===h||void 0===h?void 0:h.youtube_url,url:null===h||void 0===h?void 0:h.url,light:null!==h&&void 0!==h&&h.cover?null===h||void 0===h?void 0:h.cover:Q.OD})})]}),(0,j.jsxs)(d.A1,{sx:function(e){return{backgroundColor:e.palette.background.paper,display:"flex",margin:"0 auto"}},children:[(0,j.jsxs)(d.BW,{sx:function(e){return{padding:e.spacing(2,5),borderRight:"1px solid ".concat(e.palette.divider)}},children:[(0,j.jsx)(G,{}),(0,j.jsx)(H,{})]}),(0,j.jsx)(d._9,{sticky:!0,sx:function(e){return{padding:e.spacing(2,4),height:"100%",overflow:"auto"}},children:(0,j.jsx)(D,{})})]})]})]})}}}]);
//# sourceMappingURL=166.f0857602.chunk.js.map