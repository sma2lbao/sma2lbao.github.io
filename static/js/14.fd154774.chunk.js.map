{"version":3,"sources":["../node_modules/@material-ui/icons/esm/GitHub.js","views/auth/Login/modules/SignIn.tsx","views/auth/Login/modules/SignUp.tsx","views/auth/Login/modules/Swiper.tsx","views/auth/Login/index.tsx"],"names":["createSvgIcon","createElement","d","SignIn","RouterHelper","useRouterHelper","enqueueSnackbar","useSnackbar","usePlatformAuthWayQuery","queryData","data","queryLoading","loading","queryError","error","useLoginMutation","onCompleted","localStorage","setItem","login","gotoHome","onError","console","log","useMeLazyQuery","me","email","uid","username","gotoAuthCompletion","meQuery","React","setUsername","password","setPassword","TextField","id","label","value","onChange","e","target","placeholder","fullWidth","margin","type","Button","variant","onClick","variables","disabled","platform_auth_way","map","item","idx","key","IconButton","platform","url","http_domain","child","window","open","timer","setInterval","postMessage","addEventListener","event","clearInterval","close","access_token","thirdLogin","GitHub","setEmail","code","setCode","useHasUsernameQuery","useSendRegisterEmailMutation","send_register_email","useCreateUserWithCodeMutation","create_user_with_code","required","Box","user","AutoPlaySwipeableViews","autoPlay","SwipeableViews","useStyles","makeStyles","theme","createStyles","image","width","height","Swiper","props","classes","images","enableMouseEvents","index","i","className","Image","src","defaultProps","root","fontSize","overflow","left","flex","backgroundColor","palette","primary","main","right","background","paper","display","alignItems","justifyContent","Login","tag","setTag","_"],"mappings":"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","file":"static/js/14.fd154774.chunk.js","sourcesContent":["import React from 'react';\nimport createSvgIcon from './utils/createSvgIcon';\nexport default createSvgIcon(React.createElement(\"path\", {\n  d: \"M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3\"\n}), 'GitHub');","import * as React from \"react\";\nimport { TextField, Button, IconButton } from \"@material-ui/core\";\nimport { useSnackbar } from \"notistack\";\nimport {\n  useLoginMutation,\n  usePlatformAuthWayQuery,\n  useMeLazyQuery\n} from \"@/schema\";\nimport { useRouterHelper } from \"@/hooks\";\nimport { GitHub } from \"@material-ui/icons\";\n\nexport default function SignIn() {\n  const RouterHelper = useRouterHelper();\n  const { enqueueSnackbar } = useSnackbar();\n  const {\n    data: queryData,\n    loading: queryLoading,\n    error: queryError\n  } = usePlatformAuthWayQuery();\n  const [login, res] = useLoginMutation({\n    onCompleted(data) {\n      enqueueSnackbar(\"登录成功\");\n      localStorage.setItem(\"access_token\", data?.login);\n      RouterHelper.gotoHome();\n    },\n    onError(error) {\n      console.log(error);\n    }\n  });\n  const { loading } = res;\n\n  const [meQuery] = useMeLazyQuery({\n    onCompleted(data) {\n      if (!data.me.email || !data.me.uid || !data.me.username) {\n        RouterHelper.gotoAuthCompletion();\n      } else {\n        RouterHelper.gotoHome();\n      }\n    }\n  });\n\n  const [username, setUsername] = React.useState(\"\");\n  const [password, setPassword] = React.useState(\"\");\n\n  const _signIn = function() {\n    login({ variables: { username, password } });\n  };\n\n  const thirdLogin = function(\n    platform: string,\n    url: string,\n    http_domain: string\n  ) {\n    const child = window.open(\n      http_domain + url,\n      platform,\n      `width=450,height=450,toolbar=0,menubar=0,location=0,status=0`\n    );\n    if (child) {\n      const timer = setInterval(() => {\n        child.postMessage(\n          {\n            type: \"access_token\"\n          },\n          http_domain\n        );\n      }, 1000);\n\n      window.addEventListener(\"message\", event => {\n        const data = event.data;\n        if (data && data.type === \"access_token_callback\") {\n          clearInterval(timer);\n          child && child.close();\n\n          enqueueSnackbar(\n            data.data.access_token ? \"登录成功\" : data.data.error || \"登录失败\"\n          );\n          localStorage.setItem(\"access_token\", data.data.access_token);\n          meQuery();\n        }\n      });\n    }\n  };\n\n  return (\n    <div>\n      <form>\n        <TextField\n          id=\"username\"\n          label=\"用户名\"\n          value={username}\n          onChange={e => setUsername(e.target.value)}\n          placeholder=\"请输入用户名\"\n          fullWidth\n          margin=\"normal\"\n        />\n        <TextField\n          id=\"password\"\n          label=\"密码\"\n          type=\"password\"\n          value={password}\n          onChange={e => setPassword(e.target.value)}\n          placeholder=\"请输入密码\"\n          fullWidth\n          margin=\"normal\"\n        />\n        <Button variant=\"contained\" onClick={_signIn} disabled={loading}>\n          {loading ? \"登录中\" : \"登录\"}\n        </Button>\n      </form>\n      {queryData?.platform_auth_way.map((item, idx) => {\n        return (\n          <div key={idx}>\n            <IconButton\n              onClick={() =>\n                thirdLogin(item.platform, item.url, item.http_domain)\n              }\n            >\n              {item.platform === \"github\" && <GitHub />}\n            </IconButton>\n          </div>\n        );\n      })}\n      {queryLoading && <div>loading</div>}\n      {queryError && <div>error</div>}\n    </div>\n  );\n}\n","import * as React from \"react\";\nimport { TextField, Button, Box } from \"@material-ui/core\";\nimport { useSnackbar } from \"notistack\";\nimport {\n  useHasUsernameQuery,\n  useSendRegisterEmailMutation,\n  useCreateUserWithCodeMutation\n} from \"@/schema\";\n\nexport default function SignIn() {\n  const { enqueueSnackbar } = useSnackbar();\n  const [username, setUsername] = React.useState(\"\");\n  const [password, setPassword] = React.useState(\"\");\n  const [email, setEmail] = React.useState(\"\");\n  const [code, setCode] = React.useState(\"\");\n\n  const { data, loading } = useHasUsernameQuery({\n    variables: {\n      username: username\n    }\n  });\n  console.log(\"_changeUsername: \", username, data, loading);\n\n  // 发送验证码\n  const [send_register_email] = useSendRegisterEmailMutation({\n    onCompleted() {\n      enqueueSnackbar(\"发送成功\");\n    },\n    onError(error) {\n      console.error(error);\n      enqueueSnackbar(\"发送失败\");\n    }\n  });\n  const _sendVerifyCode = function() {\n    send_register_email({ variables: { email: email } });\n  };\n\n  // 注册\n  const [create_user_with_code] = useCreateUserWithCodeMutation({\n    onError(error) {\n      console.error(error);\n      enqueueSnackbar(\"注册失败\");\n    },\n    onCompleted(data) {\n      console.log(data);\n      enqueueSnackbar(\"注册成功\");\n    }\n  });\n  const _signUp = function() {\n    create_user_with_code({\n      variables: {\n        user: {\n          username,\n          password,\n          email,\n          code\n        }\n      }\n    });\n  };\n\n  const _changeUsername = (\n    e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>\n  ) => {\n    setUsername(e.target.value);\n  };\n\n  return (\n    <div>\n      <form>\n        <TextField\n          id=\"username\"\n          label=\"用户名\"\n          required\n          value={username}\n          onChange={_changeUsername}\n          placeholder=\"请输入用户名\"\n          fullWidth\n          margin=\"normal\"\n        />\n        <TextField\n          id=\"password\"\n          label=\"密码\"\n          type=\"password\"\n          required\n          value={password}\n          onChange={e => setPassword(e.target.value)}\n          placeholder=\"请输入密码\"\n          fullWidth\n          margin=\"normal\"\n        />\n        <TextField\n          id=\"email\"\n          label=\"邮箱\"\n          type=\"email\"\n          required\n          value={email}\n          onChange={e => setEmail(e.target.value)}\n          placeholder=\"请输入邮箱\"\n          fullWidth\n          margin=\"normal\"\n        />\n        <Box>\n          <TextField\n            id=\"code\"\n            label=\"验证码\"\n            value={code}\n            onChange={e => setCode(e.target.value)}\n            placeholder=\"请输入验证码\"\n            margin=\"normal\"\n          />\n          <Button variant=\"contained\" onClick={_sendVerifyCode}>\n            获取验证码\n          </Button>\n        </Box>\n        <Button variant=\"contained\" fullWidth onClick={_signUp}>\n          注册\n        </Button>\n      </form>\n    </div>\n  );\n}\n","import * as React from \"react\";\nimport SwipeableViews from \"react-swipeable-views\";\nimport { autoPlay } from \"react-swipeable-views-utils\";\nimport Image from \"@/components/base/Image\";\nimport { makeStyles, createStyles, Theme } from \"@material-ui/core/styles\";\n\nconst AutoPlaySwipeableViews = autoPlay(SwipeableViews);\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    image: {\n      width: \"100%\",\n      height: \"100%\"\n    }\n  })\n);\n\ninterface SwiperProps {\n  images: string[];\n}\n\nfunction Swiper(props: SwiperProps) {\n  const classes = useStyles();\n  const { images } = props;\n\n  return (\n    <div>\n      <AutoPlaySwipeableViews enableMouseEvents index={0}>\n        {images.map((item, i) => {\n          return (\n            <div className={classes.image} key={i}>\n              <Image src={item} />\n            </div>\n          );\n        })}\n      </AutoPlaySwipeableViews>\n    </div>\n  );\n}\n\nSwiper.defaultProps = {\n  images: [\n    \"https://pic1.zhimg.com/v2-cc17d8b31fe162fdbfadba1d18b7836e_1200x500.jpg\",\n    \"http://n.sinaimg.cn/collect/crawl/20160224/ZFh0-fxprucv9824132.jpg\"\n  ]\n} as Partial<SwiperProps>;\n\nexport default Swiper;\n","import * as React from \"react\";\nimport { SignIn, SignUp, Swiper } from \"./modules\";\nimport { Button, Box } from \"@material-ui/core\";\nimport { makeStyles, Theme, createStyles } from \"@material-ui/core/styles\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      width: \"100%\",\n      height: \"100vh\",\n      fontSize: 0,\n      overflow: \"hidden\"\n    },\n    left: {\n      flex: 1,\n      backgroundColor: theme.palette.primary.main\n    },\n    right: {\n      flex: 1,\n      backgroundColor: theme.palette.background.paper,\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\"\n    },\n    main: {\n      width: 300\n    }\n  })\n);\n\nexport default function Login() {\n  const classes = useStyles();\n  const [tag, setTag] = React.useState(0);\n\n  return (\n    <Box className={classes.root} display=\"flex\">\n      <div className={classes.left}>\n        <Swiper />\n      </div>\n      <div className={classes.right}>\n        <div className={classes.main}>\n          <Button onClick={_ => setTag(0)}>登录</Button>\n          <Button onClick={_ => setTag(1)}>注册</Button>\n          <div>\n            {tag === 0 && <SignIn />}\n            {tag === 1 && <SignUp />}\n          </div>\n        </div>\n      </div>\n    </Box>\n  );\n}\n"],"sourceRoot":""}